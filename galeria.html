<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeria de Projetos - SOL TECH ENERGIA SOLAR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Global Styles */
        * {
            margin: 0; /* [cite: 73] */
            padding: 0; /* [cite: 74] */
            box-sizing: border-box; /* [cite: 74] */
        }

        :root {
            --primary-color: #FFA500; /* [cite: 75] */
            --secondary-color: #FF6B35; /* [cite: 75] */
            --dark-color: #1a1a1a; /* [cite: 75] */
            --light-color: #f5f5f5; /* [cite: 75] */
            --text-color: #333; /* [cite: 75] */
            --shadow: 0 10px 30px rgba(0,0,0,0.1); /* [cite: 76] */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* [cite: 77] */
            line-height: 1.6; /* [cite: 77] */
            color: var(--text-color); /* [cite: 77] */
            background-color: var(--light-color); /* [cite: 77] */
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--dark-color) 0%, #2a2a2a 100%); /* [cite: 78] */
            color: white; /* [cite: 78] */
            padding: 1rem 0; /* [cite: 78] */
            box-shadow: var(--shadow); /* [cite: 78] */
        }

        nav {
            max-width: 1200px; /* [cite: 79] */
            margin: 0 auto; /* [cite: 79] */
            padding: 0 2rem; /* [cite: 79] */
            display: flex; /* [cite: 80] */
            justify-content: space-between; /* [cite: 80] */
            align-items: center; /* [cite: 80] */
        }

        .logo {
            font-size: 1.5rem; /* [cite: 81] */
            font-weight: bold; /* [cite: 81] */
            color: white; /* [cite: 81] */
            text-decoration: none; /* [cite: 81] */
            display: flex; /* [cite: 82] */
            align-items: center; /* [cite: 82] */
            gap: 10px; /* [cite: 82] */
        }

        .logo-img {
            height: 50px; /* [cite: 83] */
            width: auto; /* [cite: 83] */
            border-radius: 50%; /* [cite: 83] */
        }

        .back-btn {
            background: var(--primary-color); /* [cite: 84] */
            color: white; /* [cite: 84] */
            padding: 10px 20px; /* [cite: 84] */
            border-radius: 25px; /* [cite: 84] */
            text-decoration: none; /* [cite: 84] */
            transition: all 0.3s ease; /* [cite: 85] */
        }

        .back-btn:hover {
            background: var(--secondary-color); /* [cite: 86] */
            transform: translateY(-2px); /* [cite: 86] */
        }

        /* Loading Spinner */
        .loading {
            display: flex; /* [cite: 87] */
            justify-content: center; /* [cite: 87] */
            align-items: center; /* [cite: 87] */
            height: 200px; /* [cite: 87] */
        }

        .spinner {
            width: 50px; /* [cite: 88] */
            height: 50px; /* [cite: 88] */
            border: 5px solid #f3f3f3; /* [cite: 88] */
            border-top: 5px solid var(--primary-color); /* [cite: 88] */
            border-radius: 50%; /* [cite: 88] */
            animation: spin 1s linear infinite; /* [cite: 89] */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); } /* [cite: 90] */
            100% { transform: rotate(360deg); } /* [cite: 91] */
        }

        /* Main Content */
        .container {
            max-width: 1200px; /* [cite: 92] */
            margin: 0 auto; /* [cite: 92] */
            padding: 4rem 2rem; /* [cite: 92] */
        }

        .page-header {
            text-align: center; /* [cite: 93] */
            margin-bottom: 4rem; /* [cite: 93] */
        }

        .page-header h1 {
            font-size: 3rem; /* [cite: 94] */
            color: var(--dark-color); /* [cite: 94] */
            margin-bottom: 1rem; /* [cite: 94] */
        }

        .page-header p {
            font-size: 1.2rem; /* [cite: 95] */
            color: #666; /* [cite: 95] */
            max-width: 600px; /* [cite: 95] */
            margin: 0 auto; /* [cite: 95] */
        }

        /* Filters */
        .filters {
            display: flex; /* [cite: 96] */
            justify-content: center; /* [cite: 96] */
            flex-wrap: wrap; /* [cite: 96] */
            gap: 1rem; /* [cite: 96] */
            margin-bottom: 3rem; /* [cite: 96] */
        }

        .filter-btn {
            padding: 12px 24px; /* [cite: 97] */
            border: 2px solid var(--primary-color); /* [cite: 97] */
            background: white; /* [cite: 97] */
            color: var(--primary-color); /* [cite: 97] */
            border-radius: 25px; /* [cite: 97] */
            cursor: pointer; /* [cite: 97] */
            transition: all 0.3s ease; /* [cite: 97] */
            font-weight: 500; /* [cite: 97] */
            outline: none; /* [cite: 98] */
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary-color); /* [cite: 99] */
            color: white; /* [cite: 99] */
            transform: translateY(-2px); /* [cite: 99] */
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.3); /* [cite: 100] */
        }

        /* Gallery Grid */
        .gallery-grid {
            display: grid; /* [cite: 101] */
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); /* [cite: 101] */
            gap: 2rem; /* [cite: 101] */
        }

        .project-card {
            background: white; /* [cite: 102] */
            border-radius: 20px; /* [cite: 102] */
            overflow: hidden; /* [cite: 102] */
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); /* [cite: 102] */
            transition: all 0.4s ease; /* [cite: 102] */
            cursor: pointer; /* [cite: 103] */
            position: relative; /* [cite: 103] */
        }

        .project-card:hover {
            transform: translateY(-15px); /* [cite: 104] */
            box-shadow: 0 20px 40px rgba(0,0,0,0.2); /* [cite: 104] */
        }

        .project-image {
            height: 250px; /* [cite: 105] */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* [cite: 105] */
            position: relative; /* [cite: 105] */
            overflow: hidden; /* [cite: 105] */
        }

        .project-image.has-media {
            background-size: cover; /* [cite: 106] */
            background-position: center; /* [cite: 106] */
            background-repeat: no-referrer; /* [cite: 106] */
        }   

        /* Specifics for videos */
        .project-image.has-media.is-video {
            background-color: #222; /* [cite: 107] */
        }

        .project-image:not(.has-media)::before {
            content: '📸'; /* [cite: 108] */
            position: absolute; /* [cite: 108] */
            top: 50%; /* [cite: 108] */
            left: 50%; /* [cite: 108] */
            transform: translate(-50%, -50%); /* [cite: 108] */
            font-size: 80px; /* [cite: 108] */
            color: rgba(255,255,255,0.7); /* [cite: 109] */
        }

        .project-image:not(.has-media)::after {
            display: none; /* [cite: 110] */
        }

        .project-overlay {
            position: absolute; /* [cite: 111] */
            top: 0; /* [cite: 111] */
            left: 0; /* [cite: 111] */
            right: 0; /* [cite: 111] */
            bottom: 0; /* [cite: 111] */
            background: rgba(0,0,0,0.6); /* [cite: 111] */
            display: flex; /* [cite: 111] */
            align-items: center; /* [cite: 111] */
            justify-content: center; /* [cite: 112] */
            opacity: 0; /* [cite: 112] */
            transition: opacity 0.3s ease; /* [cite: 112] */
            z-index: 2; /* [cite: 112] */
        }

        .project-card:hover .project-overlay {
            opacity: 1; /* [cite: 113] */
        }

        .view-icon {
            color: white; /* [cite: 114] */
            font-size: 3rem; /* [cite: 114] */
        }

        .project-info {
            padding: 2rem; /* [cite: 115] */
            text-align: center; /* [cite: 115] */
        }

        .project-category {
            display: inline-block; /* [cite: 116] */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* [cite: 116] */
            color: white; /* [cite: 116] */
            font-weight: 600; /* [cite: 116] */
            padding: 0.5rem 1.2rem; /* [cite: 116] */
            border-radius: 20px; /* [cite: 116] */
            font-size: 0.85rem; /* [cite: 116] */
            margin-bottom: 1rem; /* [cite: 117] */
            text-transform: uppercase; /* [cite: 117] */
            letter-spacing: 0.5px; /* [cite: 117] */
        }

        .project-title {
            font-size: 1.4rem; /* [cite: 118] */
            font-weight: 700; /* [cite: 118] */
            margin-bottom: 0.5rem; /* [cite: 118] */
            color: var(--dark-color); /* [cite: 118] */
            line-height: 1.4; /* [cite: 118] */
        }

        .project-description {
            color: #666; /* [cite: 119] */
            line-height: 1.6; /* [cite: 119] */
            font-size: 0.95rem; /* [cite: 119] */
            margin-bottom: 1.5rem; /* [cite: 119] */
        }
        
        .project-specs-preview {
            display: grid; /* [cite: 120] */
            grid-template-columns: 1fr 1fr; /* [cite: 120] */
            gap: 0.75rem; /* [cite: 120] */
            padding-top: 1rem; /* [cite: 120] */
            border-top: 1px solid #eee; /* [cite: 121] */
        }
        
        .project-specs-preview .spec-item {
            font-size: 0.85rem; /* [cite: 122] */
            color: #666; /* [cite: 122] */
            display: flex; /* [cite: 122] */
            align-items: center; /* [cite: 122] */
            gap: 0.5rem; /* [cite: 122] */
        }
        
        .project-specs-preview .spec-item i {
            color: var(--primary-color); /* [cite: 123] */
            font-size: 0.9rem; /* [cite: 123] */
            width: 14px; /* [cite: 123] */
            flex-shrink: 0; /* [cite: 123] */
        }

        /* No Results / Error Messages */
        .info-message {
            text-align: center; /* [cite: 124] */
            padding: 4rem 2rem; /* [cite: 124] */
            color: #666; /* [cite: 124] */
            display: none; /* [cite: 124] */
        }

        .info-message i {
            font-size: 4rem; /* [cite: 125] */
            margin-bottom: 1rem; /* [cite: 125] */
            color: #ccc; /* [cite: 125] */
        }

        #errorMessage {
            color: #d32f2f; /* [cite: 126] */
        }
        
        #errorMessage i {
            color: #d32f2f; /* [cite: 127] */
        }

        /* Project Modal - Updated Version */
        .project-modal {
            display: none; /* [cite: 1] */
            position: fixed; /* [cite: 2] */
            z-index: 2000; /* [cite: 2] */
            left: 0; /* [cite: 2] */
            top: 0; /* [cite: 2] */
            width: 100%; /* [cite: 2] */
            height: 100%; /* [cite: 2] */
            background-color: rgba(0,0,0,0.9); /* [cite: 2] */
            animation: modalFadeIn 0.3s ease; /* [cite: 2] */
            overflow-y: auto; /* [cite: 2] */
            padding: 20px 0; /* [cite: 3] */
        }

        @keyframes modalFadeIn {
            from { opacity: 0; } /* [cite: 59] */
            to { opacity: 1; } /* [cite: 60] */
        }

        .project-modal-content {
            position: relative; /* [cite: 3] */
            margin: 2% auto; /* [cite: 4] */
            width: 90%; /* [cite: 4] */
            max-width: 1200px; /* Aumentado para dar mais espaço [cite: 4] */
            background: white; /* [cite: 4] */
            border-radius: 20px; /* [cite: 5] */
            overflow: hidden; /* [cite: 5] */
            animation: modalSlideIn 0.4s ease; /* [cite: 5] */
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); /* [cite: 5] */
        }

        @keyframes modalSlideIn {
            from { 
                transform: translateY(-50px) scale(0.9); /* [cite: 61] */
                opacity: 0; 
            }
            to { 
                transform: translateY(0) scale(1); /* [cite: 62] */
                opacity: 1; 
            }
        }

        .project-modal-close {
            position: absolute; /* [cite: 6] */
            top: 15px; /* [cite: 7] */
            right: 20px; /* [cite: 7] */
            color: white; /* [cite: 7] */
            font-size: 35px; /* [cite: 7] */
            font-weight: bold; /* [cite: 7] */
            cursor: pointer; /* [cite: 7] */
            z-index: 10; /* [cite: 7] */
            width: 45px; /* [cite: 7] */
            height: 45px; /* [cite: 7] */
            background: rgba(0,0,0,0.7); /* [cite: 7] */
            border-radius: 50%; /* [cite: 8] */
            display: flex; /* [cite: 8] */
            align-items: center; /* [cite: 8] */
            justify-content: center; /* [cite: 8] */
            transition: all 0.3s ease; /* [cite: 8] */
        }

        .project-modal-close:hover {
            background: #f44336; /* [cite: 9] */
            transform: scale(1.1) rotate(90deg); /* [cite: 10] */
        }

        /* Main Image Gallery Improvements */
        /* Ajustar a galeria para dar espaço aos controles */
        .modal-image-gallery {
            position: relative;
            height: 500px;
            background: #f8f9fa;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-bottom: 40px; /* NOVO: Espaço para os controles */
        }

        .modal-image-main {
            width: 100%; /* [cite: 13] */
            height: 100%; /* [cite: 14] */
            position: relative; /* [cite: 14] */
            display: flex; /* [cite: 14] */
            align-items: center; /* [cite: 14] */
            justify-content: center; /* [cite: 14] */
            background: #f8f9fa; /* [cite: 14] */
        }

        /* NEW APPROACH: Centered image without forced filling */
        .modal-image-main img,
        .modal-image-main video {
            max-width: 100%; /* [cite: 16] */
            max-height: 100%; /* [cite: 16] */
            object-fit: contain; /* MAIN CHANGE: contain instead of cover [cite: 16] */
            border-radius: 10px; /* [cite: 17] */
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); /* [cite: 17] */
            background: white; /* [cite: 17] */
        }

        /* Improved Placeholder */
        .modal-image-placeholder {
            display: flex; /* [cite: 17] */
            align-items: center; /* [cite: 18] */
            justify-content: center; /* [cite: 18] */
            height: 100%; /* [cite: 18] */
            font-size: 120px; /* [cite: 18] */
            color: #ddd; /* [cite: 18] */
            background: linear-gradient(135deg, #f8f9fa, #e9ecef); /* [cite: 19] */
        }

        /* Controles dinâmicos melhorados */
        /* Barra de controles reposicionada */
        .modal-image-controls {
            position: absolute;
            bottom: 5px; /* MUDANÇA: Movido para fora da área da imagem */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0,0,0,0.9); /* Fundo mais escuro */
            padding: 12px 20px; /* Padding reduzido */
            border-radius: 25px;
            backdrop-filter: blur(15px);
            z-index: 150;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .modal-control-btn {
            background: rgba(255,255,255,0.15);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .modal-control-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.1);
        }

        .modal-control-btn.fullscreen-btn {
            background: rgba(255,165,0,0.8);
        }

        .modal-control-btn.fullscreen-btn:hover {
            background: rgba(255,165,0,1);
            box-shadow: 0 4px 15px rgba(255,165,0,0.4);
        }

        /* Image Navigation - improved */
        .modal-image-nav {
            display: none !important; /* Oculta completamente as setas laterais */
        }


        .modal-image-nav:hover {
            background: rgba(0,0,0,0.9); /* [cite: 29] */
            transform: translateY(-50%) scale(1.1); /* [cite: 29] */
        }

        .modal-image-prev { left: 20px; /* [cite: 30] */ }
        .modal-image-next { right: 20px; /* [cite: 31] */ }

        /* Fullscreen Modal for Images */
        .image-fullscreen-modal {
            display: none; /* [cite: 32] */
            position: fixed; /* [cite: 32] */
            z-index: 3000; /* [cite: 32] */
            left: 0; /* [cite: 32] */
            top: 0; /* [cite: 32] */
            width: 100%; /* [cite: 32] */
            height: 100%; /* [cite: 32] */
            background-color: rgba(0,0,0,0.95); /* [cite: 32] */
            cursor: zoom-out; /* [cite: 33] */
        }

        .fullscreen-image-container {
            width: 100%; /* [cite: 33] */
            height: 100%; /* [cite: 34] */
            display: flex; /* [cite: 34] */
            align-items: center; /* [cite: 34] */
            justify-content: center; /* [cite: 34] */
            padding: 20px; /* [cite: 35] */
        }

        .fullscreen-image {
            max-width: 100%; /* [cite: 36] */
            max-height: 100%; /* [cite: 36] */
            object-fit: contain; /* [cite: 36] */
            border-radius: 5px; /* [cite: 36] */
            cursor: zoom-out; /* [cite: 36] */
        }

        .fullscreen-close {
            position: absolute; /* [cite: 37] */
            top: 20px; /* [cite: 37] */
            right: 30px; /* [cite: 37] */
            color: white; /* [cite: 37] */
            font-size: 40px; /* [cite: 37] */
            cursor: pointer; /* [cite: 37] */
            z-index: 10; /* [cite: 37] */
            transition: all 0.3s ease; /* [cite: 38] */
        }

        .fullscreen-close:hover {
            color: #ff6b6b; /* [cite: 39] */
            transform: scale(1.1); /* [cite: 39] */
        }

        /* Improved Thumbnails */
        .modal-image-thumbnails {
            display: none !important;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            max-width: 80%;
            overflow-x: auto;
            padding: 10px 15px;
            background: rgba(0,0,0,0.7);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }



        .modal-image-thumbnails.show {
            display: flex !important;
        }

        .modal-image-thumbnails.hide {
            display: none !important;
        }        

        .modal-thumbnail {
            width: 60px;
            height: 40px;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            flex-shrink: 0;
        }

        .modal-thumbnail:hover,
        .modal-thumbnail.active {
            opacity: 1;
            border-color: #FFA500;
            transform: scale(1.1);
        }

        /* Project Content Improvements */
        .project-modal-body {
            padding: 2.5rem;
            max-height: 55vh; /* Reduzido para dar espaço aos controles */
            overflow-y: auto;
            margin-top: 40px; /* NOVO: Margem para os controles */
        }

        .modal-project-header {
            margin-bottom: 2rem; /* [cite: 156] */
        }

        .modal-project-category {
            display: inline-block; /* [cite: 157] */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* [cite: 157] */
            color: white; /* [cite: 157] */
            padding: 0.5rem 1.2rem; /* [cite: 157] */
            border-radius: 20px; /* [cite: 157] */
            font-size: 0.9rem; /* [cite: 157] */
            font-weight: 600; /* [cite: 157] */
            margin-bottom: 1rem; /* [cite: 158] */
            text-transform: uppercase; /* [cite: 158] */
            letter-spacing: 0.5px; /* [cite: 158] */
        }

        .modal-project-title {
            font-size: 2.2rem; /* [cite: 159] */
            color: var(--dark-color); /* [cite: 159] */
            margin-bottom: 1rem; /* [cite: 159] */
            font-weight: 700; /* [cite: 159] */
            line-height: 1.2; /* [cite: 159] */
        }

        .modal-project-description {
            font-size: 1.1rem; /* [cite: 160] */
            line-height: 1.8; /* [cite: 160] */
            color: #555; /* [cite: 160] */
            margin-bottom: 2.5rem; /* [cite: 160] */
        }

        .modal-project-specs {
            display: block; /* Remove o grid layout [cite: 161] */
            margin-bottom: 2.5rem; /* [cite: 162] */
            padding-top: 1rem; /* [cite: 162] */
            border-top: 1px solid #f0f0f0; /* [cite: 162] */
        }

        .specs-list {
            list-style: none; /* [cite: 163] */
            padding: 0; /* [cite: 163] */
            margin: 0; /* [cite: 163] */
            column-count: 2; /* Cria duas colunas [cite: 164] */
            column-gap: 2rem; /* [cite: 164] */
        }
        .spec-item {
            display: flex; /* [cite: 165] */
            align-items: center; /* [cite: 165] */
            gap: 12px; /* [cite: 165] */
            padding: 12px 0; /* [cite: 165] */
            border-bottom: 1px solid #f5f5f5; /* [cite: 165] */
            break-inside: avoid-column; /* Evita que um item quebre entre colunas [cite: 166] */
        }
        .spec-item:last-child {
            border-bottom: none; /* [cite: 167] */
        }
        .spec-item-icon {
            font-size: 1.5rem; /* Ícone um pouco menor [cite: 168] */
            color: var(--primary-color); /* [cite: 169] */
            background-color: rgba(255, 165, 0, 0.1); /* [cite: 169] */
            width: 40px; /* [cite: 169] */
            height: 40px; /* [cite: 169] */
            border-radius: 50%; /* [cite: 169] */
            display: inline-flex; /* [cite: 169] */
            align-items: center; /* [cite: 170] */
            justify-content: center; /* [cite: 170] */
            flex-shrink: 0; /* [cite: 170] */
        }
        .spec-item-content {
            display: flex; /* [cite: 171] */
            flex-direction: column; /* [cite: 171] */
        }


        .spec-item-label {
            font-size: 0.9rem; /* [cite: 172] */
            color: #666; /* [cite: 172] */
            font-weight: 500; /* [cite: 172] */
        }

        .spec-item-value {
            font-size: 1.1rem; /* [cite: 173] */
            color: var(--dark-color); /* [cite: 173] */
            font-weight: 600; /* [cite: 173] */
        }

        /* Hide "View More Projects" button ONLY in the gallery */
        .page-gallery .modal-action-secondary {
            display: none; /* [cite: 174] */
        }

        .modal-spec-card {
            background: var(--light-color); /* [cite: 175] */
            padding: 1.5rem; /* [cite: 175] */
            border-radius: 15px; /* [cite: 175] */
            text-align: center; /* [cite: 175] */
            border-left: 4px solid var(--primary-color); /* [cite: 175] */
            transition: all 0.3s ease; /* [cite: 176] */
            position: relative; /* [cite: 176] */
            overflow: hidden; /* [cite: 176] */
        }

        .modal-spec-card::before {
            content: ''; /* [cite: 177] */
            position: absolute; /* [cite: 177] */
            top: 0; /* [cite: 177] */
            left: 0; /* [cite: 177] */
            width: 100%; /* [cite: 177] */
            height: 100%; /* [cite: 177] */
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* [cite: 177] */
            opacity: 0; /* [cite: 178] */
            transition: opacity 0.3s ease; /* [cite: 178] */
            z-index: 1; /* [cite: 178] */
        }

        .modal-spec-card:hover::before { opacity: 0.1; /* [cite: 179] */ }
        .modal-spec-card:hover {
            transform: translateY(-5px); /* [cite: 180] */
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); /* [cite: 180] */
        }

        .modal-spec-icon {
            font-size: 2.5rem; /* [cite: 181] */
            color: var(--primary-color); /* [cite: 181] */
            margin-bottom: 0.8rem; /* [cite: 181] */
            position: relative; /* [cite: 181] */
            z-index: 2; /* [cite: 181] */
        }

        .modal-spec-label {
            font-weight: 600; /* [cite: 182] */
            color: var(--dark-color); /* [cite: 182] */
            font-size: 1rem; /* [cite: 182] */
            margin-bottom: 0.3rem; /* [cite: 183] */
            position: relative; /* [cite: 183] */
            z-index: 2; /* [cite: 183] */
        }

        .modal-spec-value {
            color: #666; /* [cite: 184] */
            font-size: 1.1rem; /* [cite: 184] */
            font-weight: 500; /* [cite: 184] */
            position: relative; /* [cite: 184] */
            z-index: 2; /* [cite: 184] */
        }

        .modal-project-actions {
            display: flex; /* [cite: 185] */
            gap: 1rem; /* [cite: 185] */
            justify-content: center; /* [cite: 185] */
            flex-wrap: wrap; /* [cite: 185] */
            margin-top: 2rem; /* [cite: 185] */
            padding-top: 2rem; /* [cite: 186] */
            border-top: 1px solid #eee; /* [cite: 186] */
        }

        .modal-action-btn {
            padding: 12px 30px; /* [cite: 187] */
            border: none; /* [cite: 187] */
            border-radius: 25px; /* [cite: 187] */
            font-weight: 600; /* [cite: 187] */
            cursor: pointer; /* [cite: 187] */
            transition: all 0.3s ease; /* [cite: 187] */
            text-decoration: none; /* [cite: 188] */
            display: inline-flex; /* [cite: 188] */
            align-items: center; /* [cite: 188] */
            gap: 10px; /* [cite: 188] */
            font-size: 1rem; /* [cite: 188] */
        }

        .modal-action-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); /* [cite: 189] */
            color: white; /* [cite: 189] */
        }

        .modal-action-primary:hover {
            transform: translateY(-2px); /* [cite: 190] */
            box-shadow: 0 8px 20px rgba(255,165,0,0.4); /* [cite: 190] */
            color: white; /* [cite: 190] */
            text-decoration: none; /* [cite: 190] */
        }

        .modal-action-secondary {
            background: white; /* [cite: 191] */
            color: var(--primary-color); /* [cite: 191] */
            border: 2px solid var(--primary-color); /* [cite: 191] */
        }

        .modal-action-secondary:hover {
            background: var(--primary-color); /* [cite: 192] */
            color: white; /* [cite: 192] */
            text-decoration: none; /* [cite: 192] */
        }

        .modal-loading {
            display: flex; /* [cite: 193] */
            justify-content: center; /* [cite: 193] */
            align-items: center; /* [cite: 193] */
            height: 200px; /* [cite: 193] */
            flex-direction: column; /* [cite: 193] */
            gap: 1rem; /* [cite: 193] */
            background: white; /* [cite: 194] */
            border-radius: 20px; /* [cite: 194] */
        }

        .modal-loading-spinner {
            width: 50px; /* [cite: 195] */
            height: 50px; /* [cite: 195] */
            border: 5px solid #f3f3f3; /* [cite: 195] */
            border-top: 5px solid var(--primary-color); /* [cite: 195] */
            border-radius: 50%; /* [cite: 195] */
            animation: modalSpin 1s linear infinite; /* [cite: 196] */
        }

        @keyframes modalSpin {
            0% { transform: rotate(0deg); } /* [cite: 197] */
            100% { transform: rotate(360deg); } /* [cite: 198] */
        }

        /* Video Thumbnail Styles */
        .loading-thumbnail {
            position: relative; /* [cite: 224] */
        }

        .loading-thumbnail::after {
            content: ''; /* [cite: 225] */
            position: absolute; /* [cite: 225] */
            top: 50%; /* [cite: 225] */
            left: 50%; /* [cite: 225] */
            width: 20px; /* [cite: 226] */
            height: 20px; /* [cite: 226] */
            margin: -10px 0 0 -10px; /* [cite: 226] */
            border: 2px solid rgba(255,255,255,0.3); /* [cite: 226] */
            border-top: 2px solid rgba(255,255,255,0.8); /* [cite: 226] */
            border-radius: 50%; /* [cite: 226] */
            animation: thumbnailSpin 1s linear infinite; /* [cite: 226] */
            z-index: 1; /* Menor que o ícone de vídeo [cite: 227] */
        }

        .thumbnail-loaded::after {
            display: none; /* [cite: 228] */
        }

        @keyframes thumbnailSpin {
            0% { transform: rotate(0deg); } /* [cite: 229] */
            100% { transform: rotate(360deg); } /* [cite: 230] */
        }
        
        /* Remove old conflicting style */
        .project-image.has-media.is-video::after {
            content: ''; /* [cite: 231] */
            position: absolute; /* [cite: 231] */
            bottom: 10px; /* [cite: 231] */
            right: 10px; /* [cite: 231] */
            width: 40px; /* [cite: 231] */
            height: 40px; /* [cite: 231] */
            background: rgba(0,0,0,0.8); /* [cite: 231] */
            border-radius: 50%; /* [cite: 231] */
            display: flex; /* [cite: 232] */
            align-items: center; /* [cite: 232] */
            justify-content: center; /* [cite: 232] */
            z-index: 3; /* [cite: 232] */
            backdrop-filter: blur(5px); /* [cite: 232] */
        }

        .project-image.has-media.is-video::before {
            content: '▶'; /* [cite: 233] */
            position: absolute; /* [cite: 233] */
            bottom: 20px; /* [cite: 233] */
            right: 20px; /* [cite: 233] */
            color: white; /* [cite: 233] */
            font-size: 16px; /* [cite: 234] */
            z-index: 4; /* [cite: 234] */
            pointer-events: none; /* [cite: 234] */
        }

        .video-fallback-icon {
            position: absolute; /* [cite: 235] */
            top: 50%; /* [cite: 235] */
            left: 50%; /* [cite: 235] */
            transform: translate(-50%, -50%); /* [cite: 235] */
            z-index: 2; /* [cite: 236] */
            pointer-events: none; /* [cite: 236] */
        }

        .video-fallback-icon i {
            font-size: 3rem; /* [cite: 237] */
            color: rgba(255,255,255,0.7); /* [cite: 237] */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .specs-list {
                column-count: 1; /* Uma coluna em telas menores [cite: 199] */
            }
            .page-header h1 { font-size: 2.5rem; /* [cite: 200] */ }
            .filters { gap: 0.5rem; /* [cite: 201] */ }
            .filter-btn { padding: 10px 20px; font-size: 0.9rem; /* [cite: 202] */ }
            .gallery-grid { grid-template-columns: 1fr; gap: 1.5rem; /* [cite: 203] */ }
            .project-info { padding: 1.5rem; /* [cite: 204] */ }
            .project-modal-content { width: 95%; margin: 5% auto; /* [cite: 205] */ }
            .project-modal-body { padding: 1.5rem; /* [cite: 207] */ }
            .modal-project-title { font-size: 1.8rem; /* [cite: 208] */ }
            .modal-project-specs { grid-template-columns: 1fr 1fr; gap: 1rem; /* [cite: 209] */ }
            .modal-spec-card { padding: 1rem; /* [cite: 210] */ }
            .modal-spec-icon { font-size: 2rem; /* [cite: 211] */ }
            .modal-action-btn { padding: 10px 20px; font-size: 0.9rem; /* [cite: 212] */ }
            .modal-project-actions { flex-direction: column; align-items: stretch; /* [cite: 213] */ }
            .project-specs-preview { grid-template-columns: 1fr; gap: 0.5rem; /* [cite: 214] */ }


            .modal-image-gallery {
                height: 300px;
                padding-bottom: 30px;
            }
            
            .modal-image-controls {
                bottom: -5px; /* Ainda mais próximo em mobile */
                padding: 10px 15px;
                gap: 12px;
            }
            
            .modal-control-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
            
            .modal-image-thumbnails {
                bottom: -50px;
                max-width: 90%;
                padding: 8px 12px;
            }
            
            .modal-thumbnail {
                width: 50px;
                height: 32px;
            }









        }

        @media (max-width: 480px) {
            .container { padding: 2rem 1rem; /* [cite: 215] */ }
            .filters { flex-direction: column; align-items: stretch; text-align: center; /* [cite: 216] */ }
            .modal-project-specs { grid-template-columns: 1fr; /* [cite: 217] */ }
            .project-specs-preview { grid-template-columns: 1fr; /* [cite: 218] */ }
            .modal-image-gallery { height: 250px; /* [cite: 219] */ }
            .modal-project-title { font-size: 1.5rem; /* [cite: 220] */ }
        }

        .project-modal.opening .project-modal-content {
            animation: modalSlideInMobile 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* [cite: 221] */
        }

        @keyframes modalSlideInMobile {
            0% { 
                transform: translateY(100px) scale(0.9); /* [cite: 222] */
                opacity: 0; 
            }
            100% { 
                transform: translateY(0) scale(1); /* [cite: 223] */
                opacity: 1; 
            }
        }
    </style>

</head>
<body class="page-gallery">
    <header>
        <nav>
            <a href="index.html" class="logo">
                <img src="logo.png" alt="SOL TECH Logo" class="logo-img">
                SOL TECH
            </a>
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Voltar ao Site
            </a>
        </nav>
    </header>

    <div class="container">
        <div class="page-header">
            <h1>Nossos Projetos</h1>
            <p>Conheça nossa expertise em diferentes tipos de instalação fotovoltaica. Cada projeto é único e desenvolvido com a máxima qualidade técnica.</p>
        </div>

        <div class="filters" id="filters">
            <button class="filter-btn active" data-filter="all">Todos os Projetos</button>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
        </div>

        <div class="gallery-grid" id="galleryGrid" style="display: none;">
        </div>

        <div class="info-message" id="noResults">
            <i class="fas fa-search"></i>
            <h3>Nenhum projeto encontrado</h3>
            <p>Tente selecionar outro filtro para ver mais projetos.</p>
        </div>

        <div class="info-message" id="errorMessage">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Erro ao carregar projetos</h3>
            <p>Não foi possível conectar com o servidor. Tente novamente mais tarde.</p>
        </div>
    </div>

    <!-- Modal de Projeto -->
    <div id="projectModal" class="project-modal">
        <div class="project-modal-content">
            <span class="project-modal-close">&times;</span>
            
            <div class="modal-image-gallery">
                <div class="modal-image-main" id="modalMainImage">
                    <div class="modal-image-placeholder">📸</div>
                </div>
                
                <!-- Manter apenas os controles de navegação lateral -->
                <button class="modal-image-nav modal-image-prev" id="modalImagePrev">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="modal-image-nav modal-image-next" id="modalImageNext">
                    <i class="fas fa-chevron-right"></i>
                </button>
                
                <!-- Controles dinâmicos serão adicionados via JavaScript -->
                
                <div class="modal-image-thumbnails" id="modalImageThumbnails">
                </div>
            </div>
            
            <div class="project-modal-body">
                <div class="modal-loading" id="modalLoading">
                    <div class="modal-loading-spinner"></div>
                    <p>Carregando detalhes do projeto...</p>
                </div>
                
                <div id="modalContent" style="display: none;">
                    <div class="modal-project-header">
                        <div class="modal-project-category" id="modalCategory"></div>
                        <h2 class="modal-project-title" id="modalTitle"></h2>
                        <div class="modal-project-description" id="modalDescription"></div>
                    </div>
                    
                    <div class="modal-project-specs" id="modalSpecs">
                    </div>
                    
                    <div class="modal-project-actions">
                        <a href="#" class="modal-action-btn modal-action-primary" id="modalWhatsappBtn">
                            <i class="fab fa-whatsapp"></i>
                            Solicitar Orçamento
                        </a>
                        <a href="galeria.html" class="modal-action-btn modal-action-secondary">
                            <i class="fas fa-images"></i>
                            Ver Mais Projetos
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = '/api';
        let projects = [];
        let categories = [];

        const ui = {
            loading: document.getElementById('loading'),
            galleryGrid: document.getElementById('galleryGrid'),
            noResults: document.getElementById('noResults'),
            errorMessage: document.getElementById('errorMessage'),
            showLoading: () => { ui.loading.style.display = 'flex'; ui.galleryGrid.style.display = 'none'; ui.noResults.style.display = 'none'; ui.errorMessage.style.display = 'none'; },
            hideLoading: () => { ui.loading.style.display = 'none'; },
            showNoResults: () => { ui.galleryGrid.style.display = 'none'; ui.noResults.style.display = 'block'; },
            showError: () => { ui.galleryGrid.style.display = 'none'; ui.errorMessage.style.display = 'block'; },
            showGallery: () => { ui.galleryGrid.style.display = 'grid'; }
        };

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                if (!response.ok) throw new Error('API de categorias falhou');
                const data = await response.json();
                if (data.records) {
                    categories = data.records;
                    renderFilters();
                }
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
            }
        }

        function renderFilters() {
            const filtersContainer = document.getElementById('filters');
            const allButton = filtersContainer.querySelector('[data-filter="all"]');
            filtersContainer.innerHTML = '';
            filtersContainer.appendChild(allButton);

            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn';
                button.setAttribute('data-filter', category.slug);
                button.textContent = category.name;
                filtersContainer.appendChild(button);
            });
            setupFilterEventListeners();
        }

        async function loadProjects(categoryFilter = 'all') {
            try {
                ui.showLoading();
                let url = `${API_BASE_URL}/projects`;
                if (categoryFilter !== 'all') {
                    url += `?category=${categoryFilter}`;
                }
                const response = await fetch(url);
                if (!response.ok) throw new Error('API de projetos falhou');
                const data = await response.json();
                
                ui.hideLoading();

                if (data.records && data.records.length > 0) {
                    projects = data.records;
                    renderProjects(projects);
                    ui.showGallery();
                    
                    // Reativar event listeners
                    if (window.projectModal) {
                        window.projectModal.attachCardListeners();
                    }
                    
                    // NOVO: Aplicar thumbnails após carregamento
                    setTimeout(() => {
                        applyVideoThumbnails();
                    }, 500);
                } else {
                    ui.showNoResults();
                }
            } catch (error) {
                console.error('Erro ao carregar projetos:', error);
                ui.hideLoading();
                ui.showError();
            }
        }

        // Substitua a função renderProjects() inteira por esta versão:
        function renderProjects(projectsToRender) {
            ui.galleryGrid.innerHTML = projectsToRender.map(project => {
                const primaryMedia = project.media && project.media.length > 0 ? project.media[0] : null;
                const hasMedia = !!primaryMedia;
                const isVideo = hasMedia && primaryMedia.media_type === 'video';
                const isImage = hasMedia && primaryMedia.media_type === 'image';

                let mediaClasses = 'project-image';
                let mediaStyle = '';
                let dataAttributes = '';

                if (hasMedia) {
                    mediaClasses += ' has-media';
                    
                    if (isVideo) {
                        mediaClasses += ' is-video loading-thumbnail';
                        const videoPath = `upload/images/projects/${primaryMedia.path}`;
                        
                        // Fundo escuro temporário
                        mediaStyle = 'background-color: #2a2a2a;';
                        dataAttributes = `data-video-path="${videoPath}"`;
                    } else {
                        mediaClasses += ' is-image';
                        mediaStyle = `background-image: url('upload/images/projects/${primaryMedia.path}');`;
                    }
                }

                return `
                <div class="project-card" data-project-id="${project.id}">
                    <div class="${mediaClasses}" style="${mediaStyle}" ${dataAttributes}>
                        <div class="project-overlay">
                            <i class="fas fa-${isVideo ? 'play' : 'search-plus'} view-icon"></i>
                        </div>
                    </div>
                    <div class="project-info">
                        <div class="project-category">${project.category.name}</div>
                        <div class="project-title">${project.title}</div>
                    </div>
                </div>
                `;
            }).join('');

            // NOVO: Aplicar thumbnails de vídeo após renderizar
            setTimeout(() => {
                applyVideoThumbnails();
            }, 100);
        }

        function setupFilterEventListeners() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadProjects(this.getAttribute('data-filter'));
                });
            });
        }

        // Sistema de Modal de Projetos
        // ===== CLASSE ProjectModal CORRIGIDA =====
        class ProjectModal {
            constructor() {
                this.modal = document.getElementById('projectModal');
                this.modalContent = document.getElementById('modalContent');
                this.modalLoading = document.getElementById('modalLoading');
                this.closeBtn = document.querySelector('.project-modal-close');
                
                this.mainImage = document.getElementById('modalMainImage');
                this.prevBtn = document.getElementById('modalImagePrev');
                this.nextBtn = document.getElementById('modalImageNext');
                this.thumbnailsContainer = document.getElementById('modalImageThumbnails');
                
                this.currentProject = null;
                this.currentMediaIndex = 0; // CORRIGIDO: usar currentMediaIndex
                this.media = []; // CORRIGIDO: usar media em vez de images
                
                this.init();
            }
            
            init() {
                this.closeBtn?.addEventListener('click', () => this.close());
                this.modal?.addEventListener('click', (e) => {
                    if (e.target === this.modal) this.close();
                });
                
                // REMOVIDO: Event listeners das setas laterais (prevBtn e nextBtn)
                
                document.addEventListener('keydown', (e) => {
                    if (!this.isOpen()) return;
                    
                    switch(e.key) {
                        case 'Escape':
                            this.close();
                            break;
                        case 'ArrowLeft':
                            this.prevImage();
                            break;
                        case 'ArrowRight':
                            this.nextImage();
                            break;
                        case 'f':
                        case 'F':
                            this.openFullscreen();
                            break;
                    }
                });
                
                this.attachCardListeners();
            }

            attachCardListeners() {
                const grid = document.getElementById('galleryGrid');
                if (!grid) return;
                
                grid.addEventListener('click', (e) => {
                    const card = e.target.closest('.project-card');
                    if (card) {
                        e.preventDefault();
                        const projectId = card.getAttribute('data-project-id');
                        if (projectId) {
                            this.open(projectId);
                        }
                    }
                });
            }

            async open(projectId) {
                console.log('Abrindo modal para projeto:', projectId);
                
                if (!projectId) {
                    console.error('ID do projeto não fornecido');
                    return;
                }
                
                this.modal.style.display = 'block';
                this.modal.classList.add('opening');
                this.modalLoading.style.display = 'flex';
                this.modalContent.style.display = 'none';
                document.body.style.overflow = 'hidden';
                
                try {
                    const response = await fetch(`${API_BASE_URL}/projects.php?id=${projectId}`);
                    console.log('Resposta da API:', response.status);
                    
                    if (!response.ok) throw new Error('Projeto não encontrado');
                    
                    const project = await response.json();
                    console.log('Dados do projeto:', project);
                    this.currentProject = project;
                    
                    this.renderProject(project);
                    
                    this.modalLoading.style.display = 'none';
                    this.modalContent.style.display = 'block';
                    
                } catch (error) {
                    console.error('Erro ao carregar projeto:', error);
                    this.showError('Não foi possível carregar os detalhes do projeto. Tente novamente.');
                }
            }
            
            renderProject(project) {
                const categoryEl = document.getElementById('modalCategory');
                if (categoryEl) categoryEl.textContent = project.category?.name || 'Projeto';
                
                const titleEl = document.getElementById('modalTitle');
                if (titleEl) titleEl.textContent = project.title || 'Sem título';
                
                const descEl = document.getElementById('modalDescription');
                if (descEl) {
                    const description = project.detailed_description || project.description || 'Sem descrição disponível.';
                    descEl.innerHTML = description.replace(/\n/g, '<br>');
                }
                
                this.setupMedia(project.media || []);
                this.renderSpecs(project.specifications || {});
                this.setupWhatsAppButton(project);
            }
            
            // ===== SETUPMEDIA CORRIGIDO =====
            setupMedia(media) {
                console.log('Configurando mídias:', media);
                this.media = media.filter(m => m && m.path);
                this.currentMediaIndex = 0;

                if (this.media.length === 0) {
                    this.mainImage.innerHTML = '<div class="modal-image-placeholder">📸</div>';
                    this.mainImage.style.backgroundImage = 'none';
                    this.hideImageNavigation();
                    return;
                }

                console.log('Total de mídias válidas:', this.media.length);
                this.showCurrentMedia();

                if (this.media.length > 1) {
                    this.showImageNavigation();
                    this.renderThumbnails();
                } else {
                    this.hideImageNavigation();
                }
            }
            
            // ===== SHOWCURRENTMEDIA CORRIGIDO =====
            showCurrentMedia() {
                if (this.media.length === 0) return;

                const currentMedia = this.media[this.currentMediaIndex];
                const mediaUrl = `upload/images/projects/${currentMedia.path}`;
                
                console.log('Mostrando mídia:', this.currentMediaIndex, 'de', this.media.length, '- URL:', mediaUrl);

                this.mainImage.innerHTML = '';
                this.mainImage.style.backgroundImage = 'none';

                if (currentMedia.media_type === 'video') {
                    const videoElement = document.createElement('video');
                    videoElement.src = mediaUrl;
                    videoElement.controls = true;
                    videoElement.style.cssText = 'max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);';
                    this.mainImage.appendChild(videoElement);
                    
                    this.addVideoControls(videoElement);
                } else {
                    const img = document.createElement('img');
                    img.src = mediaUrl;
                    img.alt = 'Projeto Solar';
                    img.style.cssText = 'max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); cursor: zoom-in;';
                    img.onclick = () => this.openFullscreen();
                    
                    this.addImageControls();
                    this.mainImage.appendChild(img);
                }
            }
            
            // ===== NOVOS MÉTODOS PARA CONTROLES =====
           addImageControls() {
                const existingControls = this.modal.querySelector('.modal-image-controls');
                if (existingControls) existingControls.remove();
                
                const controls = document.createElement('div');
                controls.className = 'modal-image-controls';
                
                // Apenas os controles que cabem na barra
                let controlsHTML = '';
                
                if (this.media.length > 1) {
                    controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.prevImage()" title="Anterior"><i class="fas fa-chevron-left"></i></button>';
                }
                
                controlsHTML += '<button class="modal-control-btn fullscreen-btn" onclick="window.projectModal.openFullscreen()" title="Tela Cheia"><i class="fas fa-expand"></i></button>';
                
                if (this.media.length > 1) {
                    controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.nextImage()" title="Próxima"><i class="fas fa-chevron-right"></i></button>';
                }
                
                controls.innerHTML = controlsHTML;
                
                const gallery = this.modal.querySelector('.modal-image-gallery');
                gallery.appendChild(controls);
            }
            
            addVideoControls(videoElement) {
                const existingControls = this.modal.querySelector('.modal-image-controls');
                if (existingControls) existingControls.remove();
                
                const controls = document.createElement('div');
                controls.className = 'modal-image-controls';
                
                let controlsHTML = '';
                
                if (this.media.length > 1) {
                    controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.prevImage()" title="Anterior"><i class="fas fa-chevron-left"></i></button>';
                }
                
                controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.togglePlayPause()" title="Play/Pause"><i class="fas fa-play"></i></button>';
                controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.toggleMute()" title="Mudo"><i class="fas fa-volume-up"></i></button>';
                
                if (this.media.length > 1) {
                    controlsHTML += '<button class="modal-control-btn" onclick="window.projectModal.nextImage()" title="Próxima"><i class="fas fa-chevron-right"></i></button>';
                }
                
                controls.innerHTML = controlsHTML;
                
                const gallery = this.modal.querySelector('.modal-image-gallery');
                gallery.appendChild(controls);
                
                // Event listeners para atualizar ícones
                videoElement.addEventListener('play', () => {
                    const playBtn = controls.querySelector('i.fa-play, i.fa-pause');
                    if (playBtn) playBtn.className = 'fas fa-pause';
                });
                
                videoElement.addEventListener('pause', () => {
                    const playBtn = controls.querySelector('i.fa-play, i.fa-pause');
                    if (playBtn) playBtn.className = 'fas fa-play';
                });
                
                videoElement.addEventListener('volumechange', () => {
                    const muteBtn = controls.querySelector('i.fa-volume-up, i.fa-volume-mute');
                    if (muteBtn) {
                        muteBtn.className = videoElement.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
                    }
                });
            }
            toggleMute() {
                const video = this.mainImage.querySelector('video');
                if (video) {
                    video.muted = !video.muted;
                }
            }

            
            togglePlayPause() {
                const video = this.mainImage.querySelector('video');
                if (video) {
                    if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                }
            }
            
            showImageNavigation() {
                // REMOVIDO: Controle das setas laterais
                if (this.thumbnailsContainer) this.thumbnailsContainer.style.display = 'flex';
            }
                
            hideImageNavigation() {
                // REMOVIDO: Controle das setas laterais
                if (this.thumbnailsContainer) this.thumbnailsContainer.style.display = 'none';
            }
            
            // ===== RENDERTHUMBNAILS CORRIGIDO =====
            renderThumbnails() {
                if (!this.thumbnailsContainer) return;
                
                this.thumbnailsContainer.innerHTML = this.media.map((item, index) => {
                    const isActive = index === this.currentMediaIndex ? 'active' : '';
                    const isVideo = item.media_type === 'video';
                    const thumbStyle = !isVideo 
                        ? `background-image: url('upload/images/projects/${item.path}')` 
                        : 'background-color: #333; display:flex; align-items:center; justify-content:center;';
                    const thumbContent = isVideo ? '<i class="fas fa-play" style="color:white; font-size:12px;"></i>' : '';

                    return `<div class="modal-thumbnail ${isActive}" style="${thumbStyle}" data-index="${index}">${thumbContent}</div>`;
                }).join('');

                this.thumbnailsContainer.querySelectorAll('.modal-thumbnail').forEach((thumb, index) => {
                    thumb.addEventListener('click', () => this.goToMedia(index));
                });
            }
            
            // ===== FUNÇÕES DE NAVEGAÇÃO CORRIGIDAS =====
            prevImage() {
                console.log('Navegando para imagem anterior');
                if (this.media.length <= 1) return;
                this.currentMediaIndex = this.currentMediaIndex === 0 ? this.media.length - 1 : this.currentMediaIndex - 1;
                console.log('Novo índice:', this.currentMediaIndex);
                this.showCurrentMedia();
                this.updateThumbnails();
            }

            nextImage() {
                console.log('Navegando para próxima imagem');
                if (this.media.length <= 1) return;
                this.currentMediaIndex = this.currentMediaIndex === this.media.length - 1 ? 0 : this.currentMediaIndex + 1;
                console.log('Novo índice:', this.currentMediaIndex);
                this.showCurrentMedia();
                this.updateThumbnails();
            }

            goToMedia(index) {
                console.log('Navegando diretamente para mídia:', index);
                if (index >= 0 && index < this.media.length) {
                    this.currentMediaIndex = index;
                    this.showCurrentMedia();
                    this.updateThumbnails();
                }
            }
            
            updateThumbnails() {
                if (!this.thumbnailsContainer) return;
                
                this.thumbnailsContainer.querySelectorAll('.modal-thumbnail').forEach((thumb, index) => {
                    thumb.classList.toggle('active', index === this.currentMediaIndex);
                });
            }
            
            // ===== RENDERIZADOR DE ESPECIFICAÇÕES =====
            renderSpecs(specs) {
                const specsContainer = document.getElementById('modalSpecs');
                if (!specsContainer) return;

                const specMapping = {
                    power: { label: 'Potência', icon: 'fa-bolt' },
                    panels: { label: 'Painéis', icon: 'fa-solar-panel' },
                    area: { label: 'Área', icon: 'fa-expand-arrows-alt' },
                    savings: { label: 'Economia Mensal', icon: 'fa-coins' },
                    location: { label: 'Localização', icon: 'fa-map-marker-alt' },
                    year: { label: 'Ano', icon: 'fa-calendar' }
                };

                const specItems = Object.entries(specs)
                    .filter(([key, value]) => value && specMapping[key])
                    .map(([key, value]) => {
                        const spec = specMapping[key];
                        return `
                            <li class="spec-item">
                                <div class="spec-item-icon">
                                    <i class="fas ${spec.icon}"></i>
                                </div>
                                <div class="spec-item-content">
                                    <span class="spec-item-label">${spec.label}</span>
                                    <span class="spec-item-value">${value}</span>
                                </div>
                            </li>
                        `;
                    });
                
                if (specItems.length === 0) {
                    specsContainer.innerHTML = '<p style="text-align: center; color: #666;">Especificações técnicas não disponíveis.</p>';
                } else {
                    specsContainer.innerHTML = `<ul class="specs-list">${specItems.join('')}</ul>`;
                }
            }
            
            setupWhatsAppButton(project) {
                const whatsappBtn = document.getElementById('modalWhatsappBtn');
                if (!whatsappBtn) return;
                
                const message = `Olá! Tenho interesse no projeto "${project.title}". Gostaria de solicitar um orçamento similar.`;
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/556436011000?text=${encodedMessage}`;
                
                whatsappBtn.href = whatsappUrl;
                whatsappBtn.target = '_blank';
            }
            
            // ===== FUNCIONALIDADE FULLSCREEN =====
            openFullscreen() {
                if (this.media.length === 0 || this.media[this.currentMediaIndex].media_type === 'video') return;
                
                let fullscreenModal = document.getElementById('imageFullscreenModal');
                if (!fullscreenModal) {
                    fullscreenModal = document.createElement('div');
                    fullscreenModal.id = 'imageFullscreenModal';
                    fullscreenModal.className = 'image-fullscreen-modal';
                    fullscreenModal.innerHTML = `
                        <span class="fullscreen-close">&times;</span>
                        <div class="fullscreen-image-container">
                            <img id="fullscreenImage" class="fullscreen-image" src="" alt="">
                        </div>
                    `;
                    document.body.appendChild(fullscreenModal);
                    
                    fullscreenModal.addEventListener('click', this.closeFullscreen.bind(this));
                    fullscreenModal.querySelector('.fullscreen-close').addEventListener('click', this.closeFullscreen.bind(this));
                }
                
                const fullscreenImage = document.getElementById('fullscreenImage');
                fullscreenImage.src = `upload/images/projects/${this.media[this.currentMediaIndex].path}`;
                fullscreenModal.style.display = 'block';
            }

            closeFullscreen() {
                const fullscreenModal = document.getElementById('imageFullscreenModal');
                if (fullscreenModal) {
                    fullscreenModal.style.display = 'none';
                }
            }
            
            showError(message) {
                this.modalLoading.innerHTML = `
                    <div style="text-align: center; color: #d32f2f;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h3>Erro</h3>
                        <p>${message}</p>
                        <button onclick="window.projectModal.close()" style="margin-top: 1rem; padding: 10px 20px; background: #d32f2f; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Fechar
                        </button>
                    </div>
                `;
            }

            pauseAllVideos() {
                const videos = this.mainImage.querySelectorAll('video');
                videos.forEach(video => {
                    video.pause();
                    video.currentTime = 0;
                });
                
                const allModalVideos = this.modal.querySelectorAll('video');
                allModalVideos.forEach(video => {
                    video.pause();
                    video.currentTime = 0;
                });
            }
            
            close() {
                this.pauseAllVideos();
                
                // Limpar controles
                const existingControls = this.modal.querySelector('.modal-image-controls');
                if (existingControls) existingControls.remove();

                this.modal.style.display = 'none';
                this.modal.classList.remove('opening');
                document.body.style.overflow = 'auto';
                this.currentProject = null;
                this.media = [];
                this.currentMediaIndex = 0;

                this.mainImage.innerHTML = '<div class="modal-image-placeholder">📸</div>';
                this.mainImage.style.backgroundImage = 'none';
            }
            
            isOpen() {
                return this.modal && this.modal.style.display === 'block';
            }
        }














        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Página carregada, inicializando...');
            
            // Inicializar modal
            window.projectModal = new ProjectModal();
            
            // Carregar dados
            loadCategories();
            loadProjects();
        });

        // Função global para compatibilidade
        function openModal(projectId) {
            if (window.projectModal) {
                window.projectModal.open(projectId);
            }
        }


        // ===== SISTEMA DE THUMBNAILS PARA VÍDEOS =====
        function generateVideoThumbnail(videoPath, timeInSeconds = 0.5) {
            return new Promise((resolve, reject) => {
                const video = document.createElement('video');
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                video.crossOrigin = 'anonymous';
                video.muted = true;
                
                video.onloadedmetadata = () => {
                    video.currentTime = Math.min(timeInSeconds, video.duration);
                };
                
                video.onseeked = () => {
                    try {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const thumbnailDataURL = canvas.toDataURL('image/jpeg', 0.8);
                        resolve(thumbnailDataURL);
                        video.remove();
                    } catch (error) {
                        reject(error);
                    }
                };
                
                video.onerror = () => reject(new Error('Erro ao carregar vídeo'));
                video.src = videoPath;
                video.load();
            });
        }

        async function applyVideoThumbnails() {
            const videoElements = document.querySelectorAll('.project-image.is-video[data-video-path]');
            
            for (const element of videoElements) {
                try {
                    const videoPath = element.dataset.videoPath;
                    if (!videoPath || element.classList.contains('thumbnail-loaded')) continue;
                    
                    const thumbnailDataURL = await generateVideoThumbnail(videoPath, 0.5);
                    
                    element.style.backgroundImage = `url('${thumbnailDataURL}')`;
                    element.style.backgroundSize = 'cover';
                    element.style.backgroundPosition = 'center';
                    element.style.backgroundRepeat = 'no-repeat';
                    
                    element.classList.remove('loading-thumbnail');
                    element.classList.add('thumbnail-loaded');
                    
                } catch (error) {
                    console.error('Erro ao gerar thumbnail:', error);
                    
                    element.style.backgroundColor = '#2a2a2a';
                    element.style.backgroundImage = 'none';
                    element.classList.remove('loading-thumbnail');
                    
                    if (!element.querySelector('.video-fallback-icon')) {
                        const iconDiv = document.createElement('div');
                        iconDiv.className = 'video-fallback-icon';
                        iconDiv.innerHTML = '<i class="fas fa-play" style="font-size: 3rem; color: rgba(255,255,255,0.7);"></i>';
                        element.appendChild(iconDiv);
                    }
                }
            }
        }



    </script>



</body>
</html>